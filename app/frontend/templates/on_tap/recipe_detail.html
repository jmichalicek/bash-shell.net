{% extends 'base.html' %}
{% load wagtailcore_tags on_tap_tags %}
{% block page_stylesheets %}
  <style nonce="{{ request.csp_nonce }}">
    {# extra specificity needed here or bootstrap padding values override this #}
    td.beer-style-guide__srm {
      padding: .5rem .75rem 0;
    }
    .beer-style-guide__srm-gradient {
      {% if page.style.color_min and page.style.color_max %}
        background-image: linear-gradient(to right, {{ page.style.color_min|default:0|floatformat:"0"|srm_to_hex }}, {{ page.style.color_max|default:"40"|floatformat:"0"|srm_to_hex }});
      {% else %}
        background-image: linear-gradient(to right, {{ 0|srm_to_hex }}, {{ 40|srm_to_hex }});
      {% endif %}
      padding: .25rem .75rem;
    }

    .recipe-stats__srm {
      background-color: {{ page.calculate_color_srm|floatformat:"0"|srm_to_hex }};
      padding: .25rem .75rem;
      {# When srm is less than 7-10, the white text gets hard to read #}
      {% if page.calculate_color_srm < 10 %}color: #2B3E50;{% endif %}
    }
  </style>
{% endblock page_stylesheets %}

{% block title %}{{ page.title }}{% endblock title %}
{% block og_title %}{{ page.name }}{% endblock og_title %}
{# the default filter is not playing nicely with what I need here, so use if/else #}
{% block og_description %}{% if page.short_description %}{{ page.short_description }}{% else %}{{ page.style.name|add:" Recipe" }}{% endif %}{% endblock og_description %}

{% block primary %}
  {% with page_title=page.title %}
    {{ block.super }}
  {% endwith %}
  <div class="blog-post w-full bg-dark-bg px-4">
    <!--
        some hackery going on here - use display: block on larger screens so that I can float these to the right and get
        long intro text text to wrap around them but use display: flex and column-reverse on smaller screens so that
        I can drop the floated div down below the introduction text. This way I don't have to duplicate data in elements
        which get hidden or shown on different screen sizes.
      -->
    <div class="flex flex-col-reverse lg:block">
      <div class="lg:block w-full lg:w-1/3 lg:float-right lg:ps-3 pe-2">
        {% comment %}
          This outter div does not QUITE line up on the right with the tables below
          as it did with bootstrap 4.5, but is within a couple of px. Probably due
          to something being a bit off due to the switch to rem for everything.
          Figure it out at some point or possibly completely rework the structure.
          {% endcomment %}
        <div class="bg-card-bg border border-gray-700 rounded-lg shadow-sm mb-4">
          <div class="bg-gray-700 text-white px-4 py-3 rounded-t-lg border-b border-gray-700 font-semibold">
            Style Profile
          </div>
          <div class="p-4 pb-0">
            <dl class="grid grid-cols-2 gap-4 mb-0">
              <div class="lg:col-span-1">
                <dt class="font-semibold">O.G.:</dt><dd>{% if page.style.original_gravity_min and page.style.original_gravity_max %}{{ page.style.original_gravity_min|floatformat:"3" }} - {{ page.style.original_gravity_max|floatformat:"3" }}{% else %}N/A{% endif %}</dd>
              </div>
              <div class="lg:col-span-1">
                <dt class="font-semibold">F.G.:</dt><dd>{% if page.style.final_gravity_min and page.style.final_gravity_max %}{{ page.style.final_gravity_min|floatformat:"3" }} - {{ page.style.final_gravity_max|floatformat:"3" }}{% else %}N/A{% endif %}</dd>
              </div>
              <div class="lg:col-span-1">
                <dt class="font-semibold">IBUs:</dt><dd>{% if page.style.ibu_min and page.style.ibu_max %}{{ page.style.ibu_min|floatformat:"0" }} - {{ page.style.ibu_max|floatformat:"0" }}{% else %}N/A{% endif %}</dd>
              </div>
              <div class="lg:col-span-1">
                <dt class="beer-style-guide__srm font-semibold">Color:</dt><dd><div class="text-center beer-style-guide__srm-gradient">{{ page.style.color_min|default:0|floatformat:"0" }} - {{ page.style.color_max|default:40|floatformat:"0" }} srm</div></dd>
              </div>
            </dl>
          </div>
        </div>

        <!-- recipe profile -->
        <div class="bg-card-bg border border-gray-700 rounded-lg shadow-sm mb-4">
          <div class="bg-gray-700 text-white px-4 py-3 rounded-t-lg border-b border-gray-700 font-semibold">
            Recipe Statistics
          </div>
          <div class="p-4 pb-0">
            <dl class="grid grid-cols-2 gap-4 mb-0">
              <div class="lg:col-span-1">
                <dt class="font-semibold">O.G.:</dt><dd>{% if page.original_gravity %}{{ page.original_gravity|floatformat:"3" }}{% else %}N/A{% endif %}</dd>
              </div>
              <div class="lg:col-span-1">
                <dt class="font-semibold">F.G.:</dt><dd>{% if page.final_gravity %}{{ page.final_gravity|floatformat:"3" }}{% else %}N/A{% endif %}</dd>
              </div>
              <div class="lg:col-span-1">
                <dt class="font-semibold">IBUs:</dt><dd>{% if page.ibus_tinseth %}{{ page.ibus_tinseth|floatformat:"0" }}{% else %}N/A{% endif %}</dd>
              </div>
              <div class="lg:col-span-1">
                <dt class="beer-style-guide__srm font-semibold">Color:</dt><dd>{% if page.calculate_color_srm %}<div class="text-center recipe-stats__srm">{{ page.calculate_color_srm|floatformat:"0" }} srm</div>{% else %}N/A{% endif %}</dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
      <div>
        <div class="recipe_detail__introduction">
          {{ page.introduction }}
        </div>

      </div>
    </div>
    <div class="clear-both"></div>
    <div>
      <h2 name="recipe_details">{{ page.name }}</h2>
      <h4>{{ page.style }}</h4>
    </div>
    <table class="w-full border border-gray-600 mt-4">
      <thead class="bg-darker-bg">
        <tr><th scope="col" class="border border-gray-600 px-4 py-2 text-left text-white">Type</th><th scope="col" class="border border-gray-600 px-4 py-2 text-left text-white">Boil Volume</th><th scope="col" class="border border-gray-600 px-4 py-2 text-left text-white">Volume in Fermenter</th><th scope="col" class="border border-gray-600 px-4 py-2 text-left text-white">Boil Time</th><th scope="col" class="border border-gray-600 px-4 py-2 text-left text-white">Efficiency</th></tr>
      </thead>
      <tbody class="bg-gray-700">
        <tr>
          <td class="border border-gray-600 px-4 py-2 text-white">{{ page.get_recipe_type_display }}</td>
          <td class="border border-gray-600 px-4 py-2 text-white">{{ page.boil_size|floatformat:"2" }} {{ page.get_volume_units_display }}</td>
          <td class="border border-gray-600 px-4 py-2 text-white">{{ page.batch_size|floatformat:"2" }} {{ page.get_volume_units_display }}</td>
          <td class="border border-gray-600 px-4 py-2 text-white">{{ page.boil_time }} Minutes</td>
          <td class="border border-gray-600 px-4 py-2 text-white">{{ page.efficiency }}%</td>
        </tr>
      </tbody>
    </table>
    <h5>Fermentables</h5>
    <table class="w-full border border-gray-600 mb-0">
      <thead class="bg-darker-bg">
        <tr>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Name</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Amount</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Type</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Color</th>
        </tr>
      </thead>
      <tbody class="bg-gray-700">
        {% for fermentable in page.fermentables.all %}
          <tr>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ fermentable.name }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ fermentable.scaled_amount|default:fermentable.amount|floatformat:"2" }} {{ fermentable.get_amount_units_display }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ fermentable.get_type_display }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ fermentable.color|floatformat:"0" }} srm</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <table class="w-full border border-gray-600">
      <tr class="bg-darker-bg">
        <th class="border border-gray-600 px-4 py-2 text-left text-white">Total Grain Weight</th>
        <td class="border border-gray-600 px-4 py-2 text-white">{{ page.calculate_grain_pounds|default:"0"|floatformat:"2" }} Lbs.</td>
        {# hack which makes the weight column align with the table above #}
        <td class="border border-gray-600 px-4 py-2"></td>
        <td class="border border-gray-600 px-4 py-2"></td>
        <td class="border border-gray-600 px-4 py-2"></td>
      </tr>
    </table>

    <h5>Hops</h5>
    <table class="w-full border border-gray-600">
      <thead class="bg-darker-bg">
        <tr>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Name</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Amount</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Form</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Step</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Time</th>
        </tr>
      </thead>
      <tbody class="bg-gray-700">
        {% for hop in page.hops.all %}
          <tr>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ hop.name }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ hop.amount|floatformat:"2" }} {{ hop.get_amount_units_display }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ hop.get_form_display }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ hop.get_use_step_display }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ hop.use_time }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <h5>Yeast</h5>
    <table class="w-full border border-gray-600">
      <thead class="bg-darker-bg">
        <tr>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Name</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Amount</th>
          <th class="border border-gray-600 px-4 py-2 text-left text-white">Type</th>
        </tr>
      </thead>
      <tbody class="bg-gray-700">
        {% for yeast in page.yeasts.all %}
          <tr>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ yeast }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ yeast.amount|floatformat:"2" }} {{ yeast.get_amount_units_display }}</td>
            <td class="border border-gray-600 px-4 py-2 text-white">{{ yeast.get_yeast_type_display }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if page.miscellaneous_ingredients.exists %}
      <h5>Other Ingredients</h5>
      <table class="w-full border border-gray-600">
        <thead class="bg-darker-bg">
          <tr>
            <th class="border border-gray-600 px-4 py-2 text-left text-white">Name</th>
            <th class="border border-gray-600 px-4 py-2 text-left text-white">Amount</th>
            <th class="border border-gray-600 px-4 py-2 text-left text-white">Type</th>
            <th class="border border-gray-600 px-4 py-2 text-left text-white">Step</th>
            <th class="border border-gray-600 px-4 py-2 text-left text-white">Time</th>
          </tr>
        </thead>
        <tbody class="bg-gray-700">
          {% for misc in page.miscellaneous_ingredients.all %}
            <tr>
              <td class="border border-gray-600 px-4 py-2 text-white">{{ misc.name }}</td>
              <td class="border border-gray-600 px-4 py-2 text-white">{{ misc.amount|floatformat:"2" }} {{ misc.get_amount_units_display }}</td>
              <td class="border border-gray-600 px-4 py-2 text-white">{{ misc.get_type_display }}</td>
              <td class="border border-gray-600 px-4 py-2 text-white">{{ misc.get_use_step_display }}</td>
              <td class="border border-gray-600 px-4 py-2 text-white">{{ misc.use_time }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
        <div class="recipe_detail__conclusion">
          {{ page.conclusion }}
        </div>
      </div>
{% endblock primary %}
